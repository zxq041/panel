<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milkshake App</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Poppins', sans-serif;
            background-color: #121212;
            color: #EAEAEA;
            overflow: hidden;
        }

        #app {
            height: 100%;
        }

        /* ----- Style dla strony logowania ----- */
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
            padding-top: 15vh;
        }
        .logo-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin-bottom: 50px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.5);
        }
        .login-form-group {
            width: 80%;
            max-width: 400px;
            margin-bottom: 30px;
        }
        .login-form-label {
            display: block;
            margin-bottom: 8px;
            color: #A0A0A0;
            font-size: 0.9rem;
            text-align: left;
            padding-left: 5px;
        }
        .login-form-input {
            width: 100%;
            border: 1px solid #555;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 18px;
            padding: 16px;
            font-size: 1rem;
            color: #FFFFFF;
            transition: all 0.2s ease-in-out;
            box-sizing: border-box;
            text-align: center;
        }
        .login-form-input:focus {
            outline: none;
            border-color: #FFFFFF;
            background-color: rgba(255, 255, 255, 0.1);
        }
        .login-button {
            width: 80%;
            max-width: 400px;
            padding: 16px 0;
            background: #FFFFFF;
            color: #121212;
            font-weight: 600;
            font-size: 1.1rem;
            border: none;
            border-radius: 18px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease-in-out;
        }

        /* ----- Style dla strony głównej (swipe) ----- */
        .index-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100%;
            box-sizing: border-box;
            padding: 20px;
            overflow: hidden;
        }
        .index-content-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; width: 100%; }
        .index-footer { width: 100%; padding-top: 15px; flex-shrink: 0; }
        .admin-gear { position: absolute; top: 15px; right: 15px; z-index: 100; background-color: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 50%; width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; cursor: pointer; border: 1px solid rgba(255, 255, 255, 0.2); }
        .gear-icon { font-size: 1.8rem; }
        .card-container { position: relative; background-color: rgba(255, 255, 255, 0.05); backdrop-filter: blur(30px); width: 85vw; max-width: 350px; height: 70vh; max-height: 520px; border-radius: 25px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.7); border: 1px solid rgba(255, 255, 255, 0.15); transition: transform 0.3s ease-out; overflow: hidden; }
        .product-image { width: 150px; height: 150px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .product-name { font-size: clamp(1.5rem, 5vw, 2.2rem); font-weight: 600; text-align: center; margin-bottom: 10px; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .swipe-indicator { position: absolute; top: 30px; font-size: 2rem; font-weight: 700; padding: 5px 15px; border-radius: 15px; border: 3px solid; text-transform: uppercase; opacity: 0; transition: opacity 0.2s ease; }
        .like { left: 20px; color: #FFFFFF; border-color: #FFFFFF; transform: rotate(-20deg); }
        .nope { right: 20px; color: #777777; border-color: #777777; transform: rotate(20deg); }
        .stock-input { background-color: rgba(0,0,0,0.2); border: 1px solid #555; color: #FFFFFF; padding: 10px; border-radius: 12px; width: 120px; text-align: center; font-size: 1.2rem; }
        .summary-button { width: 100%; padding: 16px 0; background: #FFFFFF; color: #121212; font-weight: 600; font-size: 1.1rem; border: none; border-radius: 18px; box-shadow: 0 4px 20px rgba(255, 255, 255, 0.2); cursor: pointer; }
        .instructions, .no-products-container { color: #A0A0A0; text-align: center; margin-bottom: 15px; font-size: 0.8rem; }

        /* ----- Style dla Podsumowania i Panelu Admina ----- */
        .page-container { padding: 20px; }
        .page-header { font-size: 2rem; font-weight: 600; margin-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .back-button { font-size: 1rem; cursor: pointer; background-color: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 12px; }
        .list-item, .summary-box, .admin-section { background-color: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.15); padding: 15px; border-radius: 18px; margin-bottom: 15px; }
        .list-item { display: flex; justify-content: space-between; align-items: center; }
        .remove-btn { background-color: rgba(255, 255, 255, 0.1); color: #FFFFFF; width: 35px; height: 35px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; cursor: pointer; }
        .total-summary { text-align: right; }
        .total-price { font-size: 1.8rem; font-weight: bold; color: #FFFFFF; }
        .admin-section-title { font-size: 1.4rem; font-weight: 600; margin-bottom: 20px; }
        .admin-form-group { display: flex; flex-direction: column; gap: 15px; }
        .admin-input { background-color: rgba(0,0,0,0.2); border: 1px solid #555; color: #FFFFFF; padding: 12px 15px; border-radius: 12px; font-size: 1rem; }
        .online-dot { width: 10px; height: 10px; background-color: #FFFFFF; border-radius: 50%; box-shadow: 0 0 8px rgba(255, 255, 255, 0.8); }
        .user-status { display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div id="app">

        <div v-if="currentPage === 'login'" class="login-container">
            <img class="logo-image" src="https://i.imgur.com/dXRrPyB.jpeg" alt="Logo">
            <div class="login-form-group">
                <label class="login-form-label" for="loginInput">Login</label>
                <input id="loginInput" class="login-form-input" type="text" v-model="loginInput" placeholder="Wpisz swój login...">
            </div>
            <button class="login-button" @click="handleLogin">Zaloguj się</button>
        </div>

        <div v-if="currentPage === 'index'" class="index-container">
            <div class="admin-gear" v-if="isAdmin" @click="goToPage('admin')">
                <span class="gear-icon">⚙️</span>
            </div>
            <div class="index-content-area">
                <div v-if="!currentProduct" class="no-products-container">
                    <p class="info-text">Wszystkie produkty zostały przejrzane!</p>
                </div>
                <div v-if="currentProduct" class="card-container" 
                    @mousedown="onTouchStart" @mousemove="onTouchMove" @mouseup="onTouchEnd" @mouseleave="onTouchEnd"
                    @touchstart="onTouchStart" @touchmove="onTouchMove" @touchend="onTouchEnd"
                    :style="{ transform: cardTransform, cursor: isDragging ? 'grabbing' : 'grab' }">
                    <div class="swipe-indicator like" :style="{ opacity: likeOpacity }">DODAJ</div>
                    <div class="swipe-indicator nope" :style="{ opacity: nopeOpacity }">POMIŃ</div>
                    <img :src="currentProduct.imageUrl" class="product-image" alt="Zdjęcie produktu">
                    <p class="product-name">{{ currentProduct.name }}</p>
                    <p class="demand-info">Zapotrzebowanie: {{ currentProduct.demand }} {{ currentProduct.unit }}</p>
                    <div>
                        <label>Aktualny stan na magazynie:</label>
                        <input type="number" class="stock-input" v-model.number="currentStock" placeholder="0">
                    </div>
                </div>
            </div>
            <div class="index-footer">
                <div v-if="currentProduct" class="instructions">
                    <p>Przesuwaj kartę w lewo lub w prawo</p>
                </div>
                <button class="summary-button" @click="goToPage('summary')">Podsumowanie</button>
            </div>
        </div>

        <div v-if="currentPage === 'summary'" class="page-container">
            <h1 class="page-header">
                Podsumowanie Zamówienia
                <span class="back-button" @click="goToPage('index')">Powrót</span>
            </h1>
            <div v-if="shoppingCart.length === 0">Koszyk jest pusty.</div>
            <div v-else>
                <div class="list-item" v-for="(item, index) in shoppingCart" :key="item.id">
                    <div>
                        <p style="font-size: 1.2rem; font-weight: 600; margin: 0;">{{ item.name }}</p>
                        <p style="font-size: 0.9rem; color: #BDBDBD; margin: 5px 0 0 0;">
                            Ilość: {{ item.quantity.toFixed(2) }} {{ item.unit }} | Cena: {{ item.price.toFixed(2) }} zł
                        </p>
                    </div>
                    <div class="remove-btn" @click="removeItemFromCart(index)">✕</div>
                </div>
                <div class="summary-box total-summary">
                    <span style="color: #BDBDBD;">Łączna cena:</span>
                    <span class="total-price">{{ cartTotal.toFixed(2) }} zł</span>
                </div>
            </div>
        </div>

        <div v-if="currentPage === 'admin'" class="page-container">
            <h1 class="page-header">
                Panel Administratora
                <span class="back-button" @click="goToPage('index')">Powrót</span>
            </h1>
            <div class="admin-section">
                <p class="admin-section-title">Dodaj nowego pracownika</p>
                <div class="admin-form-group">
                    <input class="admin-input" v-model="newUserName" placeholder="Imię (np. Natalia)">
                    <input class="admin-input" v-model="newUserLogin" placeholder="Login (np. natalia33201)">
                    <button class="summary-button" @click="addUser">Dodaj pracownika</button>
                </div>
            </div>
            <div class="admin-section">
                <p class="admin-section-title">Zalogowani użytkownicy</p>
                <div class="user-status" v-if="currentUser">
                    <span>{{ currentUser.name }}</span>
                    <span style="display: flex; align-items: center; gap: 8px;">
                        <span class="online-dot"></span> Online
                    </span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // --- Globalny stan aplikacji ---
                    currentPage: 'login', // Strona startowa
                    users: [
                        { login: 'admin33201', name: 'Admin', permissions: 'admin' },
                        { login: 'marcin33201', name: 'Marcin', permissions: 'admin' }
                    ],
                    products: [
                        { id: 1, name: 'Mąka pszenna', demand: 10, unit: 'kg', pricePerUnit: 3.50, imageUrl: 'https://i.imgur.com/L4FJ1WJ.png' },
                        { id: 2, name: 'Cukier biały', demand: 20, unit: 'kg', pricePerUnit: 5.00, imageUrl: 'https://i.imgur.com/L4FJ1WJ.png' },
                        { id: 3, name: 'Truskawki', demand: 5, unit: 'kg', pricePerUnit: 15.00, imageUrl: 'https://i.imgur.com/L4FJ1WJ.png' },
                        { id: 4, name: 'Mleko 3.2%', demand: 30, unit: 'l', pricePerUnit: 4.20, imageUrl: 'https://i.imgur.com/L4FJ1WJ.png' },
                        { id: 5, name: 'Bita śmietana (spray)', demand: 15, unit: 'szt', pricePerUnit: 9.80, imageUrl: 'https://i.imgur.com/L4FJ1WJ.png' }
                    ],
                    shoppingCart: [],
                    currentUser: null,

                    // --- Stan dla poszczególnych "stron" ---
                    loginInput: '',
                    productIndex: 0,
                    currentStock: null,
                    touchStartX: 0,
                    cardTransform: '',
                    isDragging: false,
                    likeOpacity: 0,
                    nopeOpacity: 0,
                    newUserName: '',
                    newUserLogin: ''
                }
            },
            computed: {
                currentProduct() {
                    return this.products[this.productIndex] || null;
                },
                isAdmin() {
                    return this.currentUser && this.currentUser.permissions === 'admin';
                },
                cartTotal() {
                    return this.shoppingCart.reduce((sum, item) => sum + item.price, 0);
                }
            },
            methods: {
                // --- Nawigacja ---
                goToPage(page) {
                    this.currentPage = page;
                },

                // --- Logika logowania ---
                handleLogin() {
                    const user = this.users.find(u => u.login === this.loginInput);
                    if (user) {
                        this.currentUser = user;
                        alert(`Witaj, ${user.name}!`);
                        this.goToPage('index');
                    } else {
                        alert('Błędny login!');
                    }
                },

                // --- Logika przesuwania (swipe) ---
                onTouchStart(event) {
                    this.isDragging = true;
                    this.touchStartX = event.type.includes('mouse') ? event.clientX : event.touches[0].clientX;
                },
                onTouchMove(event) {
                    if (!this.isDragging) return;
                    const currentX = event.type.includes('mouse') ? event.clientX : event.touches[0].clientX;
                    const deltaX = currentX - this.touchStartX;
                    const rotation = deltaX / 20;
                    this.cardTransform = `translateX(${deltaX}px) rotate(${rotation}deg)`;
                    const opacityThreshold = 80;
                    this.nopeOpacity = Math.max(0, Math.min(1, deltaX / opacityThreshold));
                    this.likeOpacity = Math.max(0, Math.min(1, -deltaX / opacityThreshold));
                },
                onTouchEnd(event) {
                    if (!this.isDragging) return;
                    this.isDragging = false;
                    const finalX = event.type.includes('mouse') ? event.clientX : event.changedTouches[0].clientX;
                    const deltaX = finalX - this.touchStartX;
                    const threshold = 80;

                    if (deltaX < -threshold) this.addProductToCart();
                    else if (deltaX > threshold) this.skipProduct();
                    else this.cardTransform = 'translateX(0px) rotate(0deg)';
                    
                    this.likeOpacity = 0;
                    this.nopeOpacity = 0;
                },

                // --- Logika produktów i koszyka ---
                addProductToCart() {
                    const stock = this.currentStock || 0;
                    const demand = this.currentProduct.demand;
                    const amountToOrder = demand - stock;
                    if (amountToOrder > 0) {
                        this.shoppingCart.push({
                            ...this.currentProduct,
                            quantity: amountToOrder,
                            price: this.currentProduct.pricePerUnit * amountToOrder
                        });
                    }
                    this.nextProduct();
                },
                skipProduct() {
                    this.nextProduct();
                },
                nextProduct() {
                    this.productIndex++;
                    this.currentStock = null;
                    this.cardTransform = '';
                },
                removeItemFromCart(index) {
                    this.shoppingCart.splice(index, 1);
                },

                // --- Logika panelu admina ---
                addUser() {
                    if (!this.newUserName || !this.newUserLogin) {
                        alert('Wypełnij wszystkie pola!');
                        return;
                    }
                    if (this.users.some(u => u.login === this.newUserLogin)) {
                        alert('Ten login już istnieje!');
                        return;
                    }
                    this.users.push({
                        login: this.newUserLogin,
                        name: this.newUserName,
                        permissions: 'employee'
                    });
                    alert('Dodano pracownika!');
                    this.newUserName = '';
                    this.newUserLogin = '';
                }
            }
        }).mount('#app');
    </script>

</body>
</html>
